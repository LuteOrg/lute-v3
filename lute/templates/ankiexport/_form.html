{% for field_name, field_errors in form.errors.items() %}
<p>{{ field_name }}
  <ul>
    {% for error in field_errors %}
    <li>{{ error }}</li>
    {% endfor %}
  </ul>
</p>
{% endfor %}

<form id="export_spec_form" method="POST">
  {{ form.hidden_tag() }}

  <table id="ankiexport">
  <tbody>

    <tr>
      <td>{{ form.export_name.label(class="form-control-label") }}</td>
      <td>{{ form.export_name(class="form-control") }}</td>
    </tr>

    <tr>
      <td>{{ form.criteria.label(class="form-control-label") }}</td>
      <td>{{ form.criteria(class="form-largetextarea") }}</td>
    </tr>

    <tr>
      <td>{{ form.deck_name.label(class="form-control-label") }}</td>
      <td>{{ form.deck_name(class="form-control") }}</td>
    </tr>

    <tr>
      <td>{{ form.note_type.label(class="form-control-label") }}</td>
      <td>{{ form.note_type(class="form-control") }}</td>
    </tr>

    <tr>
      <td>{{ form.field_mapping.label(class="form-control-label") }}</td>
      <td>{{ form.field_mapping(class="form-largetextarea") }}</td>
    </tr>

    <tr>
      <td>{{ form.active.label(class="form-control-label") }}</td>
      <td>{{ form.active(class="form-control") }}</td>
    </tr>

  </tbody>
  </table>

  <button type="submit" class="btn btn-primary">Save</button>
  <button id="btnCancel" class="btn" onclick="window.location = '{{ url_for('ankiexport.anki_index') }}'; return false;">Cancel</button>
</form>


<script>

  let anki_specs = null;

  $( document ).ready(function() {
    $("#export_spec_form :input").prop("disabled", true);
    $("#btnCancel").prop("disabled", false);
    const ac_url = LUTE_USER_SETTINGS["ankiconnect_url"];
    LuteAnki.get_anki_specs(ac_url)
      .then((specs) => {
        $("#export_spec_form :input").prop("disabled", false);
        anki_specs = specs;
        alert({{ form.field_mapping.data | tojson }});
      })
      .catch(error => {
        window.alert(error);
      });
  });

</script>

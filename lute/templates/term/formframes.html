{% extends 'base.html' %}

{% block header %}
{% if term.language_id is none %}New Term{% else %}Edit Term{% endif %}
{% endblock %}

{% block body %}
<div id="term_form_left">
  {% include('term/_form.html') %}
  <a href="/term/index">Back to list</a>
</div>


<div id="term_form_right">
  <div class="dictcontainer">
    <div id="dicttabs">
      <div id="dicttabslayout"></div>
    </div>
    <div id="dictframes"></div>
  </div>
</div>

<script>let dictTabButtons;</script>

{% if term.language_id is none %}

  <script>
    const dictTabsContainer = document.getElementById("dicttabs");
    const loadDictsBtn = document.getElementById("load-dicts-btn");
    const langSelect = document.getElementById("language_id");
    const termField = document.getElementById("text");
    let term = "";
    let langid = 0;

    loadDictsBtn.addEventListener("click", (e) => {
      e.preventDefault();

      LANG_ID = langSelect.value;
      // continue only if lang or term has been changed
      if (termField.value && termField.value != term || 
          LANG_ID != 0 && LANG_ID != langid) {
            
        // delete all tabs and frames if they exist
        if (dictTabButtons) {
          const tabs = document.querySelectorAll(".dict-btn");
          const frames = document.querySelectorAll(".dictframe")
          tabs.forEach(item => item.remove())
          frames.forEach(item => item.remove())
        }

        TERM_DICTS = ALL_DICTS[LANG_ID].term;
        dictTabButtons = createDictTabs(5);
        loadDictionaries(dictTabButtons);
        addSentenceBtnEvent(dictTabButtons);

        // update the event with new dictionaries
        if (LANG_ID != langid) {
          dictTabsContainer.onclick = function(e) {
            tabsClick(e, dictTabButtons);
          };
        }

        term = termField.value;
        langid = LANG_ID;
      }
      
    })
  </script>

{% else %}

  <script>
    LANG_ID = $('#language_id').val();
    TERM_DICTS = ALL_DICTS[LANG_ID].term;
    dictTabButtons = createDictTabs(5);
    loadDictionaries(dictTabButtons);
    addSentenceBtnEvent(dictTabButtons);
  </script>

{% endif %}

{% endblock %}

{% for field_name, field_errors in form.errors.items() %}
<p>{{ field_name }}
  <ul>
    {% for error in field_errors %}
    <li>{{ error }}</li>
    {% endfor %}
  </ul>
</p>
{% endfor %}

<form method="POST">
  {{ form.hidden_tag() }}

  <table id="language">
  <tbody>

    {% for field in form %}
    {% if field.name not in ('csrf_token', 'b_entities') %}
    <tr>
      <td>{{ field.label(class="form-control-label") }}</td>
      <td>{{ field(class="form-control") }}</td>
    </tr>
    {% endif %}
    {% endfor %}

  </tbody>
  </table>

  <div id="b-entities">
    {% for b_entity in form.b_entities %}
    <div>
      {{ b_entity() }}
      <button type="button" class="remove-b-entity">Remove</button>
    </div>
    {% endfor %}
  </div>
  <button type="button" id="add-b-entity">Add B Entity</button>

  <button id="submit" type="submit" class="btn btn-primary">Save</button>
</form>

<script>
    $(document).ready(function() {
        // Make the list of entities sortable
        $("#b-entities").sortable({
            handle: ".drag-handle",
            update: function(event, ui) {
                // Handle the update event if needed
            }
        });

        // Add a new entity
        $("#add-b-entity").click(function() {
          var index = $("#b-entities").children().length;
          let template = $("#b-entities").children()[0].innerHTML;
          template = template.replaceAll('-0', `-${index}`);
          $("#b-entities").append(template);
        });

        // Remove an entity
        $(document).on("click", ".remove-b-entity", function() {
            $(this).closest("div").remove();
        });
    });
</script>

{% if language.id %}
<form method="post" action="/language/delete/{{ language.id }}" onsubmit="return confirm('WARNING: deleting a language deletes all its books and defined terms.  Are you *absolutely* sure you want to delete this item?');">
    <button class="btn">Delete</button>
</form>
{% endif %}

<button onclick="window.location = '{{ url_for('language.index') }}'">Cancel</button>
